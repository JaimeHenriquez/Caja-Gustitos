{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

  <!-- Mensajes flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-3">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show shadow-lg border-2" role="alert" style="animation: fadeIn 0.5s ease;">
            <i class="fa-solid {{ 'fa-circle-exclamation' if category == 'error' else 'fa-circle-check' }} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Tarjeta principal -->
  <div class="card shadow-lg bg-dark text-white border-danger">
    <!-- Header -->
    <div class="card-header bg-danger text-white text-center fs-3 fw-bold">
      <i class="fa-solid fa-money-bill-wave me-2"></i> Planilla de Egresos
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
      <table class="table table-dark table-hover align-middle mb-0">
        <thead class="table-danger text-white">
          <tr>
            <th>Fecha</th>
            <th>Motivo</th>
            <th>Valor</th>
            <th>Nº Boleta / Factura</th>
            <th class="text-center">Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for e in egresos %}
          <tr>
            <td>{{ e[0] }}</td>
            <td>{{ e[1] }}</td>
            <td>${{ "{:,.0f}".format(e[2] or 0) }}</td>
            <td>{{ e[3] }}</td>
            <td class="text-center">
              <div class="d-flex gap-2 justify-content-center">
                <a href="{{ url_for('editar_egreso', indice=loop.index + 1) }}" class="btn btn-sm btn-warning">
                  <i class="fa-solid fa-pen-to-square"></i> Editar
                </a>
                <form action="{{ url_for('eliminar_egreso', indice=loop.index + 1) }}" method="post"
                      onsubmit="return confirmarEliminacionEgreso()">
                  <button type="submit" class="btn btn-sm btn-danger">
                    <i class="fa-solid fa-trash"></i> Eliminar
                  </button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}

          {% if egresos %}
          <tr>
            <td colspan="4" class="text-end fw-bold">
              Total de egresos registrados:
            </td>
            <td class="fw-bold">
              Cant: {{ egresos|length }}
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="5" class="text-center text-muted">
              No hay egresos registrados.
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Footer -->
    <div class="card-footer text-center">
      <a href="{{ url_for('index') }}" class="btn btn-danger btn-lg shadow">
        <i class="fa-solid fa-house me-1"></i> Volver al Inicio
      </a>
    </div>
  </div>
</div>

<!-- Confirmación para borrar -->
<script>
  function confirmarEliminacionEgreso() {
    return confirm("¿Seguro que deseas eliminar este egreso? Esta acción no se puede deshacer.");
  }

  // Ocultar automáticamente los mensajes flash
  setTimeout(() => {
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(alert => {
      alert.classList.remove('show');
      alert.classList.add('fade');
      setTimeout(() => alert.remove(), 500);
    });
  }, 4000);
</script>

<!-- Animación CSS -->
<style>
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}
