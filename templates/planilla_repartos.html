{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

  <!-- Mensajes flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-3">
        {% for category, message in messages %}
          <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show shadow-lg border-2 border-{{ 'danger' if category == 'error' else 'success' }}" role="alert" style="animation: fadeIn 0.5s ease;">
            <i class="fa-solid {{ 'fa-circle-exclamation' if category == 'error' else 'fa-circle-check' }} me-2"></i>
            {{ message }}
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- Tarjeta principal -->
  <div class="card shadow-lg bg-dark text-white border-danger">
    <!-- Header -->
    <div class="card-header bg-danger text-white text-center fs-3 fw-bold">
      <i class="fa-solid fa-motorcycle me-2"></i> Planilla de Repartos
    </div>

    <!-- Tabla -->
    <div class="table-responsive">
      <table class="table table-dark table-hover align-middle mb-0">
        <thead class="table-danger text-white">
          <tr>
            <th>Fecha</th>
            <th>Repartidor</th>
            <th>Dirección</th>
            <th>Monto</th>
            <th>Piso Empresa</th>
            <th>Acciones</th>
          </tr>
        </thead>
                <tbody>
          {% for r in repartos %}
          <tr>
            <td>{{ r[0] }}</td>
            <td>{{ r[1] }}</td>
            <td>{{ r[2] }}</td>
            <td>${{ "{:,.0f}".format(r[3] or 0) }}</td>
            <td>${{ "{:,.0f}".format(r[4] or 0) }}</td>
            <td>
              <form action="{{ url_for('eliminar_reparto', indice=loop.index + 1) }}" method="post" onsubmit="return confirmarEliminacionReparto()">
                <button type="submit" class="btn btn-danger btn-sm w-100">
                  <i class="fa-solid fa-trash"></i> Eliminar
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}

          {% if repartos %}
          <tr>
            <td colspan="5" class="text-end fw-bold">
              Total de repartos registrados:
            </td>
            <td class="fw-bold">
              {{ repartos|length }}
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="text-center text-muted">
              No hay repartos registrados.
            </td>
          </tr>
          {% endif %}
        </tbody>

      </table>
    </div>

    <!-- Footer -->
    <div class="card-footer text-center">
      <a href="{{ url_for('index') }}" class="btn btn-danger btn-lg shadow">
        <i class="fa-solid fa-house me-1"></i> Volver al Inicio
      </a>
    </div>
  </div>
</div>

<!-- Script de confirmación -->
<script>
function confirmarEliminacionReparto() {
  return confirm("¿Seguro que deseas eliminar este reparto?");
}

// Ocultar automáticamente los mensajes flash
setTimeout(() => {
  const alerts = document.querySelectorAll('.alert');
  alerts.forEach(alert => {
    alert.classList.remove('show');
    alert.classList.add('fade');
    setTimeout(() => alert.remove(), 500);
  });
}, 4000);
</script>

<!-- Animación CSS -->
<style>
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}
